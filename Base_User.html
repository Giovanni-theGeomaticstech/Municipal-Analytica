<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8" />
    <title>Ion Rail Transit - Path Visualization tool</title>
    <link rel="stylesheet" href="https://js.arcgis.com/4.13/esri/themes/light/main.css" />
    <script src="https://js.arcgis.com/4.13/"></script>

    <style>
        html,
        body,
        #viewDiv {
            width: 100%;
            height: 100%;
            margin: 0;
            padding: 0;
        }

        #menu,
        #weighting {
            padding: 1em;
        }



        #menu>div,
        #weighting>div {
            padding: 0.4em;
        }

        select {
            font-family: "Avenir Next W00", "Helvetica Neue", Helvetica, Arial,
                sans-serif;
        }

        #submit {
            background-color: black;
            /* Green */
            border: none;
            color: white;
            padding: 10px 25px;
            text-align: center;
            text-decoration: none;
            display: inline-block;
            font-size: 14px;
            box-shadow: 0 1px 6px rgba(0, 0, 0, 0.12),
                0 1px 4px rgba(0, 0, 0, 0.24);
            position: relative;
            top: 0.8em;
            font-family: Verdana;
            transition: background-color 2s;
        }

        #submit:hover {
            background-color: white;
            color: black
        }
    </style>

    <script>
        require([
            "esri/WebScene",
            "esri/views/SceneView",
            "esri/layers/FeatureLayer",
            "esri/renderers/UniqueValueRenderer",
            "esri/symbols/PathSymbol3DLayer"
        ], function (WebScene, SceneView, FeatureLayer, UniqueValueRenderer, PathSymbol3DLayer) {
            // Create view and load an existing webscene into it
            const webscene = new WebScene({ //Creating the original ion route field
                portalItem: {
                    //autocasts as new PortalItem()
                    id: "6a4aad10e4514c2e927c916a357a2f4c"
                }
            });
            var route;

            var route_1 =
                "https://services1.arcgis.com/DwLTn0u9VBSZvUPe/arcgis/rest/services/New_Route_layers/FeatureServer/0?token=9j9mT4X-81pIGjf2GJ8C7pOiihgWEFGlsokXMvxJ4A-L2f07VfPkKqB3QLq0dC2uSn18EVuL_HD89AjEhqMWxtdKpredKKpRiIQlPyuMA6-F42cy0Te9Td4zICxU5sthBlwODwZj37mDXKs4_tQOG9ruVkfX_PyWrMHf4NSHX1WE9JKlTPirgPh1TWAdCwrFD59J6PLasCx4R6fibxgFc22Hxxb5ObCqc6padZODNpr08Bf06zQjPmFLwEY43iE7M-uDtjKRGHys39nQ7lmfwQ.."
            var route_2 =
                "https://services1.arcgis.com/DwLTn0u9VBSZvUPe/arcgis/rest/services/New_Route_layers/FeatureServer/1?token=9j9mT4X-81pIGjf2GJ8C7pOiihgWEFGlsokXMvxJ4A-L2f07VfPkKqB3QLq0dC2uSn18EVuL_HD89AjEhqMWxtdKpredKKpRiIQlPyuMA6-F42cy0Te9Td4zICxU5sthBlwODwZj37mDXKs4_tQOG9ruVkfX_PyWrMHf4NSHX1WE9JKlTPirgPh1TWAdCwrFD59J6PLasCx4R6fibxgFc22Hxxb5ObCqc6padZODNpr08Bf06zQjPmFLwEY43iE7M-uDtjKRGHys39nQ7lmfwQ.."
            var route_3 =
                "https://services1.arcgis.com/DwLTn0u9VBSZvUPe/arcgis/rest/services/New_Route_layers/FeatureServer/2?token=9j9mT4X-81pIGjf2GJ8C7pOiihgWEFGlsokXMvxJ4A-L2f07VfPkKqB3QLq0dC2uSn18EVuL_HD89AjEhqMWxtdKpredKKpRiIQlPyuMA6-F42cy0Te9Td4zICxU5sthBlwODwZj37mDXKs4_tQOG9ruVkfX_PyWrMHf4NSHX1WE9JKlTPirgPh1TWAdCwrFD59J6PLasCx4R6fibxgFc22Hxxb5ObCqc6padZODNpr08Bf06zQjPmFLwEY43iE7M-uDtjKRGHys39nQ7lmfwQ.."
            var route_4 =
                "https://services1.arcgis.com/DwLTn0u9VBSZvUPe/ArcGIS/rest/services/New_Route_layers/FeatureServer/3?token=9j9mT4X-81pIGjf2GJ8C7pOiihgWEFGlsokXMvxJ4A-L2f07VfPkKqB3QLq0dC2uSn18EVuL_HD89AjEhqMWxtdKpredKKpRiIQlPyuMA6-F42cy0Te9Td4zICxU5sthBlwODwZj37mDXKs4_tQOG9ruVkfX_PyWrMHf4NSHX1WE9JKlTPirgPh1TWAdCwrFD59J6PLasCx4R6fibxgFc22Hxxb5ObCqc6padZODNpr08Bf06zQjPmFLwEY43iE7M-uDtjKRGHys39nQ7lmfwQ.."
            var route_5 =
                "https://services1.arcgis.com/DwLTn0u9VBSZvUPe/ArcGIS/rest/services/New_Route_layers/FeatureServer/4?token=9j9mT4X-81pIGjf2GJ8C7pOiihgWEFGlsokXMvxJ4A-L2f07VfPkKqB3QLq0dC2uSn18EVuL_HD89AjEhqMWxtdKpredKKpRiIQlPyuMA6-F42cy0Te9Td4zICxU5sthBlwODwZj37mDXKs4_tQOG9ruVkfX_PyWrMHf4NSHX1WE9JKlTPirgPh1TWAdCwrFD59J6PLasCx4R6fibxgFc22Hxxb5ObCqc6padZODNpr08Bf06zQjPmFLwEY43iE7M-uDtjKRGHys39nQ7lmfwQ.."
            var route_6 =
                "https://services1.arcgis.com/DwLTn0u9VBSZvUPe/ArcGIS/rest/services/New_Route_layers/FeatureServer/5?token=9j9mT4X-81pIGjf2GJ8C7pOiihgWEFGlsokXMvxJ4A-L2f07VfPkKqB3QLq0dC2uSn18EVuL_HD89AjEhqMWxtdKpredKKpRiIQlPyuMA6-F42cy0Te9Td4zICxU5sthBlwODwZj37mDXKs4_tQOG9ruVkfX_PyWrMHf4NSHX1WE9JKlTPirgPh1TWAdCwrFD59J6PLasCx4R6fibxgFc22Hxxb5ObCqc6padZODNpr08Bf06zQjPmFLwEY43iE7M-uDtjKRGHys39nQ7lmfwQ.."
            var new_routes = [route_1, route_2, route_3, route_4, route_5, route_6]

            function create_Feature(layer) { //Note that layer is a string
                var Ion_Routes = new FeatureLayer({
                    url: layer,
                    elevationInfo: {
                        mode: "relative-to-ground",
                        offset: 20
                    },
                    title: "Ion Routes",
                    outFields: ["*"]
                });
                return Ion_Routes
            }


            const view = new SceneView({
                container: "viewDiv",
                map: webscene,
                qualityProfile: "high",
                environment: {
                    lighting: {
                        directShadowsEnabled: true,
                        ambientOcclusionEnabled: true
                    },
                    atmosphere: {
                        quality: "high"
                    }
                }
            });


            const options = {
                profile: "quad",
                cap: "round",
                join: "miter",
                width: 30,
                height: 30,
                color: [200, 200, 200],
                profileRotation: "all"
            };







            /****************************************
             * Function that sets a renderer with a
             * unique path symbol for each transit line.
             * The path symbol uses the properties from
             * the options object, which are set everytime
             * the user modifies the settings in the menu.
             * **************************************/

            /* The colors used for the each transit line */
            const colors = {
                A: [255, 0, 16],
                B: [0, 170, 227],
                C: [248, 150, 29],
                D: [0, 166, 63],
                F1: [189, 239, 133],
                F2: [189, 239, 133]
            };

            //route is the layer being added
            //id is the route number
            function renderTransitLayer(route) {
                var renderer = new UniqueValueRenderer({
                    field: "Route_ID"
                });
                property = colors.A
                renderer.addUniqueValueInfo({
                    value: property,
                    symbol: {
                        type: "line-3d",
                        symbolLayers: [{
                            type: "path",
                            profile: options.profile,
                            material: {
                                color: colors[property]
                            },
                            width: 100, //options.width,
                            height: options.height,
                            join: options.join,
                            cap: options.cap,
                            anchor: "bottom",
                            profileRotation: options.profileRotation
                        }]
                    }
                });

                route.renderer
            }



            /*************************************************
             * The rest of the sample adds event listeners
             * on the input elements in the menu, to modify
             * the path properties in the options object and
             * rerender the layer.
             *************************************************/

            const styleSelect = document.getElementById("style");
            styleSelect.addEventListener("change", function (event) {
                const value = event.target.value;
                switch (value) {
                    case "round-tube":
                        options.profile = "circle";
                        options.height = 30;
                        options.width = 30;
                        break;
                    case "square-tube":
                        options.profile = "quad";
                        options.height = 30;
                        options.width = 30;
                        break;
                    case "wall":
                        options.profile = "quad";
                        options.height = 30;
                        options.width = 5;
                        break;
                    case "strip":
                        options.profile = "quad";
                        options.height = 5;
                        options.width = 30;
                        break;
                }
                renderTransitLayer(route);
            });

            const capSelect = document.getElementById("cap");
            capSelect.addEventListener("change", function (event) {
                options.cap = event.target.value;
                renderTransitLayer(route);
            });

            const joinSelect = document.getElementById("join");
            joinSelect.addEventListener("change", function (event) {
                console.log(event.target.value);
                options.join = event.target.value;
                renderTransitLayer(route);
            });

            const rotationSelect = document.getElementById("profileRotation");
            rotationSelect.addEventListener("change", function (event) {
                options.profileRotation = event.target.value;
                renderTransitLayer(route);
            });

            //My code 

            var criteria_list = [null, null, null]; //Initialize it as the base case
            const criteria_1 = document.getElementById("criteria_1");
            const criteria_2 = document.getElementById("criteria_2");
            const criteria_3 = document.getElementById("criteria_3");
            const submit_button = document.getElementById("submit");

            criteria_1.addEventListener("change", function (event) {
                const value = event.target.value;
                GetSelectedValue()
            });
            criteria_2.addEventListener("change", function (event) {
                const value = event.target.value;
                GetSelectedValue()
            });
            criteria_3.addEventListener("change", function (event) {
                const value = event.target.value;
                GetSelectedValue()
            });




            function GetSelectedValue() {
                var result_1 = criteria_1.options[criteria_1.selectedIndex].value;
                var result_2 = criteria_2.options[criteria_2.selectedIndex].value;
                var result_3 = criteria_3.options[criteria_3.selectedIndex].value;

                criteria_list[0] = result_1
                criteria_list[1] = result_2
                criteria_list[2] = result_3

                //The the values results 
                //routeChosen(criteria_list[0], criteria_list[1], criteria_list[2])
            }

            /////////////////////////////////////////////////////////////////////////
            //This function checks if the weightings are done correctly
            function check_weightings() {
                var c1 = criteria_list[0]
                var c2 = criteria_list[1]
                var c3 = criteria_list[2]

                if (criteria_list.includes(null)) { //initial test
                    alert("You have not assigned all your weightings!")
                    console.log(criteria_list)
                } else if (c1 == c3 || c1 == c2 || c2 == c3) {
                    alert('Keep choosing unique weightings!')
                } else {
                    alert('Your Route will be added!')
                    routeChosen(c1, c2, c3)
                }
            }

            function routeChosen(c1, c2, c3) {
                if (c1 = "weight 1" && c2 == "weight 2" && c3 == "weight 3") {
                    console.log('me 1')
                    route = create_Feature(new_routes[0])
                    renderTransitLayer(route)
                    webscene.add(route);
                    //console.log(webscene.layers)
                    //renderTransitLayer(route, 1);
                } else if (c1 = "weight 3" && c2 == "weight 2" && c3 == "weight 1") {
                    console.log('me 2')
                    route = create_Feature(new_routes[1])
                    renderTransitLayer(route)
                    webscene.add(route);
                } else if (c1 = "weight 1" && c2 == "weight 3" && c3 == "weight 2") {
                    console.log('me 3')
                    route = create_Feature(new_routes[2])
                    renderTransitLayer(route)
                    webscene.add(route);
                } else if (c1 = "weight 3" && c2 == "weight 1" && c3 == "weight 2") {
                    console.log('me 4')
                    route = create_Feature(new_routes[3])
                    renderTransitLayer(route)
                    webscene.add(route);
                } else if (c1 = "weight 2" && c2 == "weight 1" && c3 == "weight 3") {
                    console.log('me 5')
                    route = create_Feature(new_routes[4])
                    renderTransitLayer(route)
                    webscene.add(route);
                } else if (c1 = "weight 2" && c2 == "weight 3" && c3 == "weight 1") {
                    console.log('me 6')
                    route = create_Feature(new_routes[5])
                    renderTransitLayer(route)
                    webscene.add(route);
                }
            }

            submit_button.addEventListener('click', check_weightings)

            view.ui.add("weighting", "top-right");
        });
    </script>
</head>

<body>
    <div id="viewDiv" class="esri-widget"></div>

    <div id="menu" class="esri-widget">
        <p>Choose path properties:</p>
        <div>
            <label for="style">Style</label>
            <select id="style">
                <option value="wall">Wall</option>
                <option value="square-tube">Square tube</option>
                <option value="round-tube">Round tube</option>
                <option value="strip">Strip</option>
            </select>
        </div>
        <div>
            <label for="cap">Cap</label>
            <select id="cap">
                <option value="round">Round</option>
                <option value="butt">Butt</option>
                <option value="square">Square</option>
                <option value="none">None</option>
            </select>
        </div>
        <div>
            <label for="join">Join</label>
            <select id="join">
                <option value="miter">Miter</option>
                <option value="round">Round</option>
                <option value="bevel">Bevel</option>
            </select>
        </div>
        <div>
            <label for="profileRotation">Profile rotation</label>
            <select id="profileRotation">
                <option value="all">All</option>
                <option value="heading">Heading</option>
            </select>
        </div>
    </div>

    <!--Here for doing our weightings-->

    <div id="weighting" class="esri-widget">
        <!-- Got change the id of this-->
        <p>Choose a Weighting to <br> Generate a route:</p>
        <div>
            <label for="style">Population</label>
            <select id="criteria_1">
                <option value="weight 1">1</option>
                <option value="weight 2">2</option>
                <option value="weight 3">3</option>
            </select>
        </div>
        <div>
            <label for="cap">Land Use</label>
            <select id="criteria_2">
                <option value="weight 1">1</option>
                <option value="weight 2">2</option>
                <option value="weight 3">3</option>
            </select>
        </div>
        <div>
            <label for="join">Economic</label>
            <select id="criteria_3">
                <option value="weight 1">1</option>
                <option value="weight 2">2</option>
                <option value="weight 3">3</option>
            </select>
            <br>`<input id="submit" type="submit" value="Submit">
        </div>
    </div>
</body>

</html>